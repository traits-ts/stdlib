##
##  @rse/traits - Traits for TypeScript Classes
##  Copyright (c) 2025 Dr. Ralf S. Engelschall <rse@engelschall.com>
##  Licensed under MIT license <https://spdx.org/licenses/MIT>
##

#   all-in-one development
dev
    nodemon --exec "npm start lint build test" --watch src --ext ts,1

#   static code analysis (linting)
lint
    tsc --project etc/tsc.json --noEmit && \
    oxlint --config etc/oxlint.jsonc src/**/*.ts && \
    biome lint --diagnostic-level=warn --config-path=etc/biome.jsonc src/*.ts && \
    eslint --config etc/eslint.mts src/**/*.ts

#   static code analysis (linting) [watching]
lint-watch
    nodemon --exec "npm start lint" --watch src --ext ts,1

#   code compilation/transpiling (building)
build
    VITE_BUILD_FORMATS=esm,cjs vite --config etc/vite.mts build --mode production
    VITE_BUILD_FORMATS=umd     vite --config etc/vite.mts build --mode production

#   code compilation/transpiling (building) [watching]
build-watch
    nodemon --exec "npm start build" --watch src --ext ts,1

#   test
test
    NODE_OPTIONS="--import=tsx" mocha src/traits-stdlib.spec.ts

#   cleanup (built artifacts)
clean
    shx rm -rf dst-stage1 dst-stage2

#   cleanup (bootstrap artifacts)
clean-dist: clean
    shx rm -rf node_modules

